<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Graduation Rate Success</title>
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
    <!-- include google web fonts -->
    <link href="https://fonts.googleapis.com/css?family=Titillium+Web|Oswald" rel="stylesheet">
    <link href="https://api.mapbox.com/mapbox-gl-js/v2.8.1/mapbox-gl.css" rel="stylesheet">
    <!-- include icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="css/pov_chart.css">
    <link rel="stylesheet" href="css/style.css" />
    <script src="https://api.mapbox.com/mapbox-gl-js/v2.8.1/mapbox-gl.js"></script>
</head>
<style>
    #map {
        position: absolute;
        top: 0;
        bottom: 0;
        width: 100%;
        z-index: 1001;
    }

    #info {
        display: none;
    }

</style>

<body>
    <!-- sidebar -->
    <div id="info">
        <div id="title">
            High School Graduation Rates and Poverty Rate
            <span><a href="https://twitter.com/UW" target="_blank"><i class="bi bi-twitter"></i></a></span>
            <span><a href="https://github.com/jakobzhao/geog458" target="_blank"><i class="bi bi-github"></i></a></span>
            <span id="reset"><a href="#">reset</a></span>
        </div>
        <div id="count" class="card">
            <h5 id="desc">TITLE FOR CHART ON DASHBOARD GOES HERE </h5>
        </div>

        <div id="footer">
            Income data from US Census: <a href="https://data.census.gov/table/ACSDT1Y2018.B19013?q=b19013&g=010XX00US$0600000_040XX00US53$0500000">Census</a>
            Graduation Rate data from Washington Geospatial Open Data Portal: <a href="https://geo.wa.gov/datasets/d4a6f3c1a45d48b9b31de9ebaf5af4ee_0/explore?location=47.237631%2C-120.811974%2C8.00">Washington Geospatial Open Data Portal</a>
        </div>
    </div>
    <div id="map"></div>

    <script>
        mapboxgl.accessToken = 'pk.eyJ1IjoiamFrb2J6aGFvIiwiYSI6ImNpcms2YWsyMzAwMmtmbG5icTFxZ3ZkdncifQ.P9MBej1xacybKcDN_jehvw';
    
        // declare the map object
        let map = new mapboxgl.Map({
            container: 'map', // container ID
            style: 'mapbox://styles/mapbox/light-v10', // lighter map style
            zoom: 6, // starting zoom (adjust as needed)
            center: [-120.5, 47.5] // center coordinates for Washington state
        });
    
        async function geojsonFetch() {
            let response;
            response = await fetch('assets/pov_rate.geojson');
            pov_data = await response.json();
    
            console.log('GeoJSON data:', pov_data); // Log the loaded GeoJSON data
    
            map.on('load', () => {
                console.log('Map loaded');
    
                map.addSource('pov_data', {
                    type: 'geojson',
                    data: pov_data,
                    generateId: true
                });
    
                console.log('Source added to the map:', map.getSource('pov_data'));
    
                map.addLayer({
                    'id': 'pov_data_layer',
                    'type': 'fill',
                    'source': 'pov_data',
                    'paint': {
                        'fill-color': [
                            'interpolate',
                            ['linear'],
                            ['get', 'Percent_Living_in_Poverty'],
                            0, '#888888',
                            10, '#FED976',
                            20, '#FEB24C',
                            30, '#FD8D3C',
                            40, '#FC4E2A',
                            50, '#E31A1C',
                            60, '#800026'
                        ],
                        'fill-opacity': 0.7
                    }
                });
    
                map.addLayer({
                    'id': 'pov_data_line',
                    'type': 'line',
                    'source': 'pov_data',
                    'paint': {
                        'line-color': '#000000',
                        'line-width': .5,
                    }
                });

                const firstFeatureValue = pov_data.features[0].properties.Percent_Living_in_Poverty;
                console.log('Value of Percent_Living_in_Poverty:', firstFeatureValue);
    
                console.log('Layers added to the map:', map.getStyle().layers);
            });
        }
    
        geojsonFetch();
    </script>
    <div id="legend"></div>
</body>

</html>
